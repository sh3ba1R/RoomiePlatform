<!-- filepath: c:\Users\saaud\Documents\GitHub\RoomiePlatform\roomie\templates\user_profile.html -->
{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- Cover Photo/Banner Area -->
<div class="profile-cover-container position-relative mb-5">
  <div class="profile-cover-bg bg-primary"></div>
  <div class="container position-relative">
    <div class="profile-header">
      <div class="profile-avatar-wrapper">
        {% if user.profile_photo %}
        <img
          src="{{ user.profile_photo.url }}"
          class="profile-avatar"
          alt="{{ user.username }}"
        />
        {% else %}
        <img
          src="/media/profile_photos/default_user.jpg"
          class="profile-avatar"
          alt="Default Profile Image"
        />
        {% endif %}
      </div>
      <div class="profile-info-container">
        <h1 class="fw-bold mb-2 text-white">{{ user.username }}</h1>
        <div class="profile-badges mb-3">
          <span class="badge bg-light text-primary fw-medium">
            {{ user.get_account_type_display }}
          </span>
          {% if user.gender %}
          <span class="badge bg-light text-primary fw-medium">
            {{ user.get_gender_display }}
          </span>
          {% endif %}
          {% if user.location %}
          <span class="badge bg-light text-primary fw-medium">
            <i class="fas fa-map-marker-alt me-1"></i>{{ user.location }}
          </span>
          {% endif %}
        </div>

        {% if request.user.is_authenticated and request.user.id == user.id %}
        <div class="mt-3">
          <a href="#" class="btn btn-light btn-sm">
            <i class="fas fa-edit me-1"></i> Edit Profile
          </a>
          <a href="{% url 'dashboard' %}" class="btn btn-light btn-sm ms-2">
            <i class="fas fa-tachometer-alt me-1"></i> Dashboard
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row g-4">
    <!-- Left Column - Profile Cards -->
    <div class="col-lg-4">
      <!-- Profile Actions Card -->
      <div class="card shadow-sm profile-card mb-4">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="card-title mb-0">
              <i class="fas fa-user-circle text-primary me-2"></i> Profile
            </h5>
            <span class="profile-status online" title="Online"></span>
          </div>

          <div class="text-center mb-4">
            <p class="text-muted">{{ user.email }}</p>
            <div class="profile-stats d-flex justify-content-center">
              <div class="me-4 text-center">
                <div class="h5 mb-1">
                  {{ user.rooms.all.count|default:"0" }}
                </div>
                <div class="small text-muted">Rooms</div>
              </div>
              <div class="me-4 text-center">
                <div class="h5 mb-1">0</div>
                <div class="small text-muted">Reviews</div>
              </div>
              <div class="text-center">
                <div class="h5 mb-1">
                  {% if user.date_joined %}
                  {{ user.date_joined|date:"Y"|add:"-2023" }}
                  {% else %}
                  0
                  {% endif %}
                </div>
                <div class="small text-muted">Years</div>
              </div>
            </div>
          </div>

          <!-- Contact button (only show if viewing another user's profile) -->
          {% if request.user.is_authenticated and request.user.id != user.id %}
          <div class="d-grid gap-2">
            <a href="{% url 'send_message' user.id %}" class="btn btn-primary">
              <i class="fas fa-envelope me-2"></i> Message {{ user.username }}
            </a>
            <button class="btn btn-outline-primary">
              <i class="fas fa-user-plus me-2"></i> Connect
            </button>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Verification Status -->
      <div class="card shadow-sm mb-4">
        <div class="card-body p-4">
          <h5 class="card-title mb-3">
            <i class="fas fa-shield-alt text-primary me-2"></i> Verification
          </h5>
          <ul class="list-group list-group-flush verification-list">
            <li
              class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-3"
            >
              <span>
                <i class="fas fa-check-circle text-success me-2"></i>
                Email
              </span>
              <span class="badge bg-success rounded-pill">Verified</span>
            </li>
            <li
              class="list-group-item d-flex justify-content-between align-items-center border-0 px-0 pb-3"
            >
              <span>
                <i class="fas fa-check-circle text-success me-2"></i>
                Phone
              </span>
              <span class="badge bg-success rounded-pill">Verified</span>
            </li>
            <li
              class="list-group-item d-flex justify-content-between align-items-center border-0 px-0"
            >
              <span>
                <i class="fas fa-times-circle text-muted me-2"></i> ID
                Verification
              </span>
              <span class="badge bg-light text-dark rounded-pill">Pending</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Right Column - Profile Content -->
    <div class="col-lg-8">
      <!-- Profile Tabs -->
      <div class="profile-tabs mb-4">
        <ul class="nav nav-pills nav-fill" id="profileTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="about-tab"
              data-bs-toggle="tab"
              data-bs-target="#about"
              type="button"
              role="tab"
              aria-selected="true"
            >
              <i class="fas fa-user me-2"></i> About
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="rooms-tab"
              data-bs-toggle="tab"
              data-bs-target="#rooms"
              type="button"
              role="tab"
              aria-selected="false"
            >
              <i class="fas fa-home me-2"></i> Rooms
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="reviews-tab"
              data-bs-toggle="tab"
              data-bs-target="#reviews"
              type="button"
              role="tab"
              aria-selected="false"
            >
              <i class="fas fa-star me-2"></i> Reviews
            </button>
          </li>
        </ul>

        <div class="tab-content mt-4" id="profileTabsContent">
          <!-- About Tab -->
          <div
            class="tab-pane fade show active"
            id="about"
            role="tabpanel"
            aria-labelledby="about-tab"
          >
            <!-- Bio Card -->
            <div class="card shadow-sm mb-4">
              <div class="card-body p-4">
                <h5
                  class="card-title d-flex align-items-center border-bottom pb-3 mb-4"
                >
                  <i class="fas fa-info-circle text-primary me-2"></i> Bio
                </h5>
                <div class="bio-content">
                  {{ user.bio|default:"No bio provided"|linebreaks }}
                </div>
              </div>
            </div>
          </div>

          <!-- Rooms Tab -->
          <div
            class="tab-pane fade"
            id="rooms"
            role="tabpanel"
            aria-labelledby="rooms-tab"
          >
            <div class="card shadow-sm">
              <div class="card-body p-4">
                <div
                  class="d-flex justify-content-between align-items-center border-bottom pb-3 mb-4"
                >
                  <h5 class="card-title mb-0">
                    <i class="fas fa-home text-primary me-2"></i> Listed Rooms
                  </h5>
                  {% if user.account_type == 'provider' and request.user.id == user.id %}
                  <a
                    href="{% url 'list_room' %}"
                    class="btn btn-primary btn-sm"
                  >
                    <i class="fas fa-plus me-1"></i> Add New Room
                  </a>
                  {% endif %}
                </div>

                <div class="row g-4 mt-2">
                  {% for room in user.rooms.all %}
                  <div class="col-md-6">
                    <div class="card room-card h-100">
                      <div class="room-image-container">
                        {% if room.image %}
                        <img
                          src="{{ room.image.url }}"
                          class="card-img-top room-image"
                          alt="{{ room.title }}"
                        />
                        {% else %}
                        <img
                          src="/media/images/default_room.jpg"
                          class="card-img-top room-image"
                          alt="Default Room Image"
                        />
                        {% endif %}
                        <span class="room-price-badge">${{ room.rent }}/month</span>
                        {% if room.is_available %}
                        <span class="room-status-badge available">Available</span>
                        {% else %}
                        <span class="room-status-badge unavailable">Unavailable</span>
                        {% endif %}
                      </div>
                      <div class="card-body p-3">
                        <h5 class="card-title mb-1">{{ room.title }}</h5>
                        <p class="text-muted small mb-2">
                          <i class="fas fa-map-marker-alt me-1"></i> {{ room.location }}
                        </p>
                        <div class="room-features mb-3">
                          <span class="badge bg-light text-dark me-1">{{ room.get_room_type_display }}</span>
                          <span class="badge bg-light text-dark me-1">{{ room.bedrooms }} Bedrooms</span>
                        </div>
                        <p class="card-text small">{{ room.description|truncatechars:60 }}</p>
                        <div class="d-flex justify-content-between mt-3">
                          <a
                            href="{% url 'room_detail' room.room_id %}"
                            class="btn btn-outline-primary btn-sm"
                          >
                            <i class="fas fa-info-circle me-1"></i> Details
                          </a>
                          {% if request.user.id == user.id %}
                          <a
                            href="{% url 'delete_room' room.room_id %}"
                            class="btn btn-outline-danger btn-sm"
                          >
                            <i class="fas fa-trash me-1"></i> Delete
                          </a>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  </div>
                  {% empty %}
                  <div class="col-12 text-center py-5">
                    <i class="fas fa-home fa-3x text-muted mb-3"></i>
                    <h5>No Rooms Listed</h5>
                    <p class="text-muted">
                      This user hasn't listed any rooms yet.
                    </p>
                    {% if user.account_type == 'provider' and request.user.id == user.id %}
                    <a
                      href="{% url 'list_room' %}"
                      class="btn btn-primary mt-2"
                    >
                      <i class="fas fa-plus me-1"></i> List Your First Room
                    </a>
                    {% endif %}
                  </div>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>

          <!-- Reviews Tab -->
          <div
            class="tab-pane fade"
            id="reviews"
            role="tabpanel"
            aria-labelledby="reviews-tab"
          >
            <div class="card shadow-sm">
              <div class="card-body p-4">
                <h5 class="card-title border-bottom pb-3 mb-4">
                  <i class="fas fa-star text-primary me-2"></i> Reviews & Ratings
                </h5>

                <div class="text-center py-5">
                  <i class="fas fa-star fa-3x text-muted mb-3"></i>
                  <h5>No Reviews Yet</h5>
                  <p class="text-muted">
                    This user hasn't received any reviews yet.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}