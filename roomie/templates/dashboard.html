{% extends 'base.html' %} {% load static %} {% block content %}
<div class="container">
  <!-- Header with user welcome -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm border-0 bg-primary text-white">
        <div class="card-body p-4">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              {% if user.profile_photo %}
              <img
                src="{{ user.profile_photo.url }}"
                class="rounded-circle border border-3 border-white"
                style="width: 75px; height: 75px; object-fit: cover"
                alt="{{ user.username }}"
              />
              {% else %}
              <img
                src="/media/profile_photos/default_user.jpg"
                class="rounded-circle border border-3 border-white"
                style="width: 75px; height: 75px; object-fit: cover"
                alt="Default Profile"
              />
              {% endif %}
            </div>
            <div class="flex-grow-1 ms-3">
              <h2 class="mb-1">Welcome back, {{ user.username }}!</h2>
              <p class="mb-0">
                <i class="fas fa-user me-1"></i> {{
                user.get_account_type_display }} Account {% if user.location %}
                â€¢ <i class="fas fa-map-marker-alt me-1"></i> {{ user.location }}
                {% endif %}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Dashboard content -->
  <div class="row">
    <!-- Left column - stats and actions -->
    <div class="col-lg-4">
      <!-- Quick stats -->
      <div class="card shadow-sm mb-4">
        <div class="card-body p-4">
          <h5 class="card-title mb-3">
            <i class="fas fa-chart-pie text-primary me-2"></i> Account Overview
          </h5>

          <div class="list-group list-group-flush">
            <!-- Messages stat -->
            <div class="list-group-item border-0 px-0 py-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <i class="fas fa-envelope text-primary me-2"></i> Messages
                </div>
                <span class="badge bg-primary rounded-pill"
                  >{{ unread_messages|default:"0" }}</span
                >
              </div>
              <p class="text-muted small mb-0">New unread messages</p>
            </div>

            <!-- Profile views stat -->
            <div class="list-group-item border-0 px-0 py-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <i class="fas fa-eye text-primary me-2"></i> Profile Views
                </div>
                <span class="badge bg-secondary rounded-pill"
                  >{{ profile_views|default:"0" }}</span
                >
              </div>
              <p class="text-muted small mb-0">In the last 7 days</p>
            </div>

            <!-- Account status -->
            <div class="list-group-item border-0 px-0 py-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <i class="fas fa-check-circle text-success me-2"></i> Account
                  Status
                </div>
                <span class="badge bg-success">Active</span>
              </div>
              <p class="text-muted small mb-0">
                Your account is in good standing
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick actions -->
      <div class="card shadow-sm mb-4">
        <div class="card-body p-4">
          <h5 class="card-title mb-3">
            <i class="fas fa-bolt text-primary me-2"></i> Quick Actions
          </h5>

          <div class="d-grid gap-2">
            {% if user.account_type == 'provider' %}
            <a href="{% url 'list_room' %}" class="btn btn-outline-primary">
              <i class="fas fa-plus-circle me-2"></i> List a New Room
            </a>
            {% endif %}

            <a href="{% url 'find_roommate' %}" class="btn btn-outline-primary">
              <i class="fas fa-search me-2"></i> Find Roommates
            </a>

            <a
              href="{% url 'messages' user.id %}"
              class="btn btn-outline-primary"
            >
              <i class="fas fa-envelope me-2"></i> Check Messages
            </a>

            <a
              href="{% url 'user_profile' user.id %}"
              class="btn btn-outline-primary"
            >
              <i class="fas fa-edit me-2"></i> Update Profile
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Right column - recent activity and recommendations -->
    <div class="col-lg-8">
      <!-- Recent activity -->
      <div class="card shadow-sm mb-4">
        <div class="card-body p-4">
          <h5 class="card-title mb-3">
            <i class="fas fa-history text-primary me-2"></i> Recent Activity
          </h5>

          {% if recent_messages or recent_views %}
          <div class="timeline">
            {% for message in recent_messages|slice:":3" %}
            <div class="timeline-item">
              <div class="timeline-marker bg-primary">
                <i class="fas fa-envelope text-white"></i>
              </div>
              <div class="timeline-content">
                <h6 class="mb-1">
                  New message from {{ message.sender.username }}
                </h6>
                <p class="small text-muted mb-1">{{ message.subject }}</p>
                <p class="small text-muted mb-0">
                  {{ message.timestamp|timesince }} ago
                </p>
              </div>
            </div>
            {% endfor %}

            <!-- Placeholder activity items if no real data -->
            {% if not recent_messages and not recent_views %}
            <div class="timeline-item">
              <div class="timeline-marker bg-primary">
                <i class="fas fa-user-plus text-white"></i>
              </div>
              <div class="timeline-content">
                <h6 class="mb-1">You created your account</h6>
                <p class="small text-muted mb-0">
                  {{ user.date_joined|timesince }} ago
                </p>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-marker bg-success">
                <i class="fas fa-check text-white"></i>
              </div>
              <div class="timeline-content">
                <h6 class="mb-1">Your profile was verified</h6>
                <p class="small text-muted mb-0">
                  {{ user.date_joined|timesince }} ago
                </p>
              </div>
            </div>
            {% endif %}
          </div>
          {% else %}
          <div class="text-center py-4">
            <i class="fas fa-history fa-3x text-muted mb-3"></i>
            <h6>No Recent Activity</h6>
            <p class="text-muted small mb-0">
              Your recent activities will appear here.
            </p>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Recommended roommates or rooms -->
      <div class="card shadow-sm">
        <div class="card-body p-4">
          {% if user.account_type == 'seeker' %}
          <h5 class="card-title mb-3">
            <i class="fas fa-home text-primary me-2"></i> Recommended Rooms
          </h5>

          {% if recommended_rooms %}
          <div class="row g-3">
            {% for room in recommended_rooms|slice:":3" %}
            <div class="col-md-4">
              <div class="card h-100 shadow-sm">
                {% if room.image %}
                <img
                  src="{{ room.image.url }}"
                  class="card-img-top"
                  style="height: 120px; object-fit: cover"
                  alt="{{ room.title }}"
                />
                {% else %}
                <div class="bg-light text-center py-4">
                  <i class="fas fa-home fa-2x text-muted"></i>
                </div>
                {% endif %}
                <div class="card-body p-3">
                  <h6 class="card-title mb-1">{{ room.title }}</h6>
                  <p class="small text-muted mb-2">
                    <i class="fas fa-map-marker-alt me-1"></i> {{ room.location
                    }}
                  </p>
                  <p class="fw-bold text-primary mb-0">
                    ${{ room.rent }}/month
                  </p>
                </div>
                <div class="card-footer bg-transparent border-top-0 p-3 pt-0">
                  <a href="#" class="btn btn-sm btn-outline-primary w-100"
                    >View Details</a
                  >
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <!-- Placeholder rooms -->
          <div class="row g-3">
            <div class="col-md-4">
              <div class="card h-100 shadow-sm">
                <div class="bg-light text-center py-4">
                  <i class="fas fa-home fa-2x text-muted"></i>
                </div>
                <div class="card-body p-3">
                  <h6 class="card-title mb-1">Cozy Studio Downtown</h6>
                  <p class="small text-muted mb-2">
                    <i class="fas fa-map-marker-alt me-1"></i> Central Area
                  </p>
                  <p class="fw-bold text-primary mb-0">$850/month</p>
                </div>
                <div class="card-footer bg-transparent border-top-0 p-3 pt-0">
                  <a href="#" class="btn btn-sm btn-outline-primary w-100"
                    >View Details</a
                  >
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card h-100 shadow-sm">
                <div class="bg-light text-center py-4">
                  <i class="fas fa-home fa-2x text-muted"></i>
                </div>
                <div class="card-body p-3">
                  <h6 class="card-title mb-1">Private Room in Shared House</h6>
                  <p class="small text-muted mb-2">
                    <i class="fas fa-map-marker-alt me-1"></i> University
                    District
                  </p>
                  <p class="fw-bold text-primary mb-0">$650/month</p>
                </div>
                <div class="card-footer bg-transparent border-top-0 p-3 pt-0">
                  <a href="#" class="btn btn-sm btn-outline-primary w-100"
                    >View Details</a
                  >
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card h-100 shadow-sm">
                <div class="bg-light text-center py-4">
                  <i class="fas fa-home fa-2x text-muted"></i>
                </div>
                <div class="card-body p-3">
                  <h6 class="card-title mb-1">Modern Apartment</h6>
                  <p class="small text-muted mb-2">
                    <i class="fas fa-map-marker-alt me-1"></i> East Side
                  </p>
                  <p class="fw-bold text-primary mb-0">$1,200/month</p>
                </div>
                <div class="card-footer bg-transparent border-top-0 p-3 pt-0">
                  <a href="#" class="btn btn-sm btn-outline-primary w-100"
                    >View Details</a
                  >
                </div>
              </div>
            </div>
          </div>
          {% endif %} {% else %}
          <!-- For providers, show potential roommates -->
          <h5 class="card-title mb-3">
            <i class="fas fa-users text-primary me-2"></i> Potential Roommates
          </h5>

          <div class="row g-3">
            {% for roommate in recommended_roommates|slice:":3" %}
            <div class="col-md-4">
              <div class="card h-100 shadow-sm text-center p-3">
                {% if roommate.profile_photo %}
                <img
                  src="{{ roommate.profile_photo.url }}"
                  class="rounded-circle mx-auto mt-2"
                  style="width: 80px; height: 80px; object-fit: cover"
                  alt="{{ roommate.username }}"
                />
                {% else %}
                <img
                  src="/media/profile_photos/default_user.jpg"
                  class="rounded-circle mx-auto mt-2"
                  style="width: 80px; height: 80px; object-fit: cover"
                  alt="Default Profile"
                />
                {% endif %}
                <div class="card-body p-2">
                  <h6 class="card-title mb-1">{{ roommate.username }}</h6>
                  {% if roommate.location %}
                  <p class="small text-muted mb-2">
                    <i class="fas fa-map-marker-alt me-1"></i> {{
                    roommate.location }}
                  </p>
                  {% endif %}
                  <a
                    href="{% url 'user_profile' roommate.id %}"
                    class="btn btn-sm btn-outline-primary w-100"
                    >View Profile</a
                  >
                </div>
              </div>
            </div>
            {% empty %}
            <!-- Placeholder roommates -->
            <div class="col-md-4">
              <div class="card h-100 shadow-sm text-center p-3">
                <img
                  src="/media/profile_photos/default_user.jpg"
                  class="rounded-circle mx-auto mt-2"
                  style="width: 80px; height: 80px; object-fit: cover"
                  alt="Default Profile"
                />
                <div class="card-body p-2">
                  <h6 class="card-title mb-1">Sarah Johnson</h6>
                  <p class="small text-muted mb-2">
                    <i class="fas fa-map-marker-alt me-1"></i> University
                    District
                  </p>
                  <a href="#" class="btn btn-sm btn-outline-primary w-100"
                    >View Profile</a
                  >
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card h-100 shadow-sm text-center p-3">
                <img
                  src="/media/profile_photos/default_user.jpg"
                  class="rounded-circle mx-auto mt-2"
                  style="width: 80px; height: 80px; object-fit: cover"
                  alt="Default Profile"
                />
                <div class="card-body p-2">
                  <h6 class="card-title mb-1">Michael Lee</h6>
                  <p class="small text-muted mb-2">
                    <i class="fas fa-map-marker-alt me-1"></i> Downtown
                  </p>
                  <a href="#" class="btn btn-sm btn-outline-primary w-100"
                    >View Profile</a
                  >
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card h-100 shadow-sm text-center p-3">
                <img
                  src="/media/profile_photos/default_user.jpg"
                  class="rounded-circle mx-auto mt-2"
                  style="width: 80px; height: 80px; object-fit: cover"
                  alt="Default Profile"
                />
                <div class="card-body p-2">
                  <h6 class="card-title mb-1">Emma Wilson</h6>
                  <p class="small text-muted mb-2">
                    <i class="fas fa-map-marker-alt me-1"></i> East Side
                  </p>
                  <a href="#" class="btn btn-sm btn-outline-primary w-100"
                    >View Profile</a
                  >
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Timeline styling */
  .timeline {
    position: relative;
    padding-left: 40px;
  }

  .timeline-item {
    position: relative;
    padding-bottom: 20px;
  }

  .timeline-item:not(:last-child):before {
    content: "";
    position: absolute;
    left: -33px;
    top: 25px;
    height: calc(100% - 10px);
    width: 2px;
    background: #e9ecef;
  }

  .timeline-marker {
    position: absolute;
    left: -40px;
    top: 0;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
  }

  /* Dark mode compatibility */
  body.dark-mode .timeline-item:not(:last-child):before {
    background: var(--dark-border);
  }
</style>
{% endblock %}
